<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provider Dashboard</title>
</head>
<body>
    <h1>Provider Dashboard</h1>

    <h2>Work Requests</h2>
    <ul id="workRequests"></ul>

    <h2>Upload Work</h2>
    <form id="uploadForm">
        <label for="providerName">Your Name:</label>
        <input type="text" id="providerName" required><br>

        <label for="pdfFile">Upload PDF:</label>
        <input type="file" id="pdfFile" accept=".pdf" required><br>

        <button type="submit">Upload</button>
    </form>

    <h2>Your Star Rating</h2>
    <p>Name: <span id="providerDisplayName">Provider</span> <span id="helperTag"></span></p>
    <p>Stars: <span id="starRating">0</span></p>

    <script>
        let tasksCompleted = localStorage.getItem("tasksCompleted") || 0;  // Load tasks from localStorage
        const userRequests = JSON.parse(localStorage.getItem("userRequests")) || [];

        // Display requests from the user
        function displayRequests() {
            const requestList = document.getElementById("workRequests");
            requestList.innerHTML = "";
            userRequests.forEach((request, index) => {
                if (request.status === "Pending") {
                    const listItem = document.createElement("li");
                    listItem.innerHTML = `
                        <strong>Request by:</strong> ${request.name} <br>
                        <strong>Subject:</strong> ${request.subject} <br>
                        <strong>Chapters:</strong> ${request.chapters} <br>
                        <button onclick="completeRequest(${index})">Complete Request</button>
                    `;
                    requestList.appendChild(listItem);
                }
            });
        }

        // Complete request and upload PDF
        function completeRequest(index) {
            const providerName = document.getElementById("providerName").value;
            const pdfFile = document.getElementById("pdfFile").files[0];

            if (!pdfFile || !providerName) {
                alert("Please enter your name and upload a PDF.");
                return;
            }

            const pdfLink = URL.createObjectURL(pdfFile);

            // Mark request as completed and save data
            userRequests[index].status = "Completed";
            userRequests[index].providerName = providerName;
            userRequests[index].pdfLink = pdfLink;

            tasksCompleted += 1;

            // Save to localStorage
            localStorage.setItem("userRequests", JSON.stringify(userRequests));
            localStorage.setItem("tasksCompleted", tasksCompleted);

            updateStars();
            alert("Request completed successfully!");
            displayRequests();
        }

        // Update stars based on tasks completed
        function updateStars() {
            const stars = Math.floor(tasksCompleted / 1);
            document.getElementById("starRating").innerText = stars;

            if (stars >= 10) {
                document.getElementById("helperTag").innerText = " (Best Helper)";
            }
        }

        displayRequests();  // Display requests on page load
    </script>
</body>
</html>
